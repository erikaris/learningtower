---
title: "Explanation of data munging"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load packages, include=FALSE}
library(tidyverse)
```


# Sources

Data files for years 2000, 2003, 2006, 2009, 2012, 2015, 2018, were downloaded from https://www.oecd.org/pisa/data/. The format of the data provided is different across years.

Only text files are provided up to 2012, along with SPSS read scripts. These were read with `read_fwf()` after reading the SPSS format files, computing the field widths from the start, end columns for each variable, and using the provided variable name. The code for doing this is in the `data-raw` folder.

Binary SPSS files are provided for 2015, 2018. These files are read in into R using the `read_sav()` function in the `haven` package.

# Variable selection, renaming and merging of years

The datasets have a very large number and varying variable names between years. Variables have been selected and the data for each year and questionnaire combined to enable a longitudinal analysis. 

The following provides the variable naming for each questionnaire:

**Student Questionnaire**

The student questionnaire data file (which also includes estimates of student performance and parent-questionnaire data) has been reduced to the following variable subset: 

*Note* this is the current 2018 naming convention and is subject to change on a review of the data sets.

```{r student variables}
Name <- c("CNT", "CNTSCHID","CNTSTUID","ST004D01T" , "ST005Q01TA" ,"ST007Q01TA" ,"ST011Q04TA" ,"ST011Q06TA"
 , "W_FSTUWT",   "PV1MATH" ,   "PV1READ" ,   "PV1SCIE")
Description<- c("Country code 3-character","Intl. School ID","Intl. Student ID","What is the <highest level of schooling> completed by your mother?","What is the <highest level of schooling> completed by your father?","Student (Standardized) Gender","In your home: A computer you can use for school work","In your home: A link to the Internet","Plausible Value 1 in Mathematics","Plausible Value 1 in Reading","Plausible Value 1 in Science","FINAL TRIMMED NONRESPONSE ADJUSTED STUDENT WEIGHT")
data.frame(Name,Description) %>% 
  knitr::kable()
```

